// 社交分享工具库
import type { DreamAnalysis } from './dreamAI';

export interface ShareContent {
  title: string;
  text: string;
  url: string;
  hashtags: string[];
  image?: string;
}

export interface ShareStats {
  totalShares: number;
  platformShares: Record<string, number>;
  achievements: string[];
}

class SocialShareManager {
  private baseUrl: string = '';
  private shareStats: ShareStats = {
    totalShares: 0,
    platformShares: {},
    achievements: []
  };

  constructor() {
    if (typeof window !== 'undefined') {
      this.baseUrl = window.location.origin;
      this.loadShareStats();
    }
  }

  // 生成解梦分享内容
  generateDreamShareContent(dreamResult: DreamAnalysis, dream: string): ShareContent {
    const scoreText = this.getScoreText(dreamResult.score);
    const culturalEmoji = this.getCulturalEmoji(dreamResult.keywords);

    const title = `🌙 我的香港解梦结果：${scoreText}`;

    const text = this.generateShareText(dreamResult, dream);

    const hashtags = [
      '香港解梦',
      'AI解梦',
      '周公解梦',
      '香港文化',
      ...dreamResult.keywords.slice(0, 3)
    ];

    return {
      title,
      text,
      url: `${this.baseUrl}?shared=dream`,
      hashtags,
      image: this.generateShareImage(dreamResult)
    };
  }

  // 生成游戏成就分享内容
  generateGameShareContent(gameType: 'xiaoren' | 'shanbao', score: number, totalScore: number): ShareContent {
    const gameInfo = gameType === 'xiaoren'
      ? { name: '鹅颈桥打小人', emoji: '👤', action: '成功祛除厄运' }
      : { name: '长洲岛抢山包', emoji: '🥟', action: '收获满满福气' };

    const title = `🎮 ${gameInfo.emoji} ${gameInfo.name}游戏成功！`;

    const text = `刚在香港解梦APP玩了${gameInfo.name}，${gameInfo.action}！获得${score}积分，总积分达到${totalScore}分！

${this.getScoreDescription(totalScore)}

一起来体验正宗的香港民俗文化吧！`;

    return {
      title,
      text,
      url: `${this.baseUrl}?shared=game&type=${gameType}`,
      hashtags: ['香港解梦', '民俗游戏', '香港文化', gameInfo.name, '打小人', '抢山包'],
      image: this.generateGameShareImage(gameType, score)
    };
  }

  // 分享到不同平台
  async shareToWeChat(content: ShareContent): Promise<boolean> {
    try {
      // 检测是否在微信环境中
      if (this.isWeChatBrowser()) {
        // 在微信中使用 JS-SDK 分享
        this.showWeChatShareModal(content);
        return true;
      } else {
        // 非微信环境，生成二维码或提示
        this.showWeChatQRCode(content);
        return true;
      }
    } catch (error) {
      console.error('微信分享失败:', error);
      return false;
    }
  }

  async shareToWeibo(content: ShareContent): Promise<boolean> {
    try {
      const url = `https://service.weibo.com/share/share.php?${new URLSearchParams({
        url: content.url,
        title: content.text,
        pic: content.image || '',
        searchPic: 'false'
      })}`;

      window.open(url, '_blank', 'width=600,height=400');
      this.recordShare('weibo');
      return true;
    } catch (error) {
      console.error('微博分享失败:', error);
      return false;
    }
  }

  async shareToFacebook(content: ShareContent): Promise<boolean> {
    try {
      const url = `https://www.facebook.com/sharer/sharer.php?${new URLSearchParams({
        u: content.url,
        quote: content.text
      })}`;

      window.open(url, '_blank', 'width=600,height=400');
      this.recordShare('facebook');
      return true;
    } catch (error) {
      console.error('Facebook分享失败:', error);
      return false;
    }
  }

  async shareToTwitter(content: ShareContent): Promise<boolean> {
    try {
      const url = `https://twitter.com/intent/tweet?${new URLSearchParams({
        text: content.text,
        url: content.url,
        hashtags: content.hashtags.join(',')
      })}`;

      window.open(url, '_blank', 'width=600,height=400');
      this.recordShare('twitter');
      return true;
    } catch (error) {
      console.error('Twitter分享失败:', error);
      return false;
    }
  }

  async shareToLinkedIn(content: ShareContent): Promise<boolean> {
    try {
      const url = `https://www.linkedin.com/sharing/share-offsite/?${new URLSearchParams({
        url: content.url
      })}`;

      window.open(url, '_blank', 'width=600,height=400');
      this.recordShare('linkedin');
      return true;
    } catch (error) {
      console.error('LinkedIn分享失败:', error);
      return false;
    }
  }

  // 使用原生分享API（移动端）
  async shareNative(content: ShareContent): Promise<boolean> {
    try {
      if (navigator.share) {
        await navigator.share({
          title: content.title,
          text: content.text,
          url: content.url
        });
        this.recordShare('native');
        return true;
      } else {
        throw new Error('不支持原生分享');
      }
    } catch (error) {
      console.error('原生分享失败:', error);
      return false;
    }
  }

  // 复制分享链接
  async copyShareLink(content: ShareContent): Promise<boolean> {
    try {
      const shareText = `${content.title}\n\n${content.text}\n\n🔗 ${content.url}`;

      if (navigator.clipboard) {
        await navigator.clipboard.writeText(shareText);
      } else {
        // 降级方案
        const textArea = document.createElement('textarea');
        textArea.value = shareText;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
      }

      this.recordShare('copy');
      return true;
    } catch (error) {
      console.error('复制失败:', error);
      return false;
    }
  }

  // 私有方法

  private generateShareText(dreamResult: DreamAnalysis, dream: string): string {
    const scoreText = this.getScoreText(dreamResult.score);
    const keywordsText = dreamResult.keywords.length > 0
      ? `关键词：${dreamResult.keywords.slice(0, 3).join('、')}`
      : '';

    return `刚用香港解梦APP解了个梦：${dream.slice(0, 30)}${dream.length > 30 ? '...' : ''}

🌙 解梦结果：${scoreText}
${keywordsText}

${dreamResult.advice}

快来体验AI智能解梦和香港民俗文化吧！`;
  }

  private getScoreText(score: number): string {
    if (score >= 8) return '大吉大利 🎉';
    if (score >= 5) return '运势上佳 ✨';
    if (score >= 0) return '平安顺遂 🙏';
    if (score >= -5) return '小心谨慎 ⚠️';
    return '需要化解 🔥';
  }

  private getScoreDescription(totalScore: number): string {
    if (totalScore >= 50) return '🏆 解梦大师！运势爆棚！';
    if (totalScore >= 25) return '⭐ 运势不错，继续保持！';
    if (totalScore >= 0) return '📈 运势平稳，稳步上升！';
    if (totalScore >= -25) return '⚡ 运势起伏，需要调整！';
    return '🔄 运势低迷，建议多玩打小人！';
  }

  private getCulturalEmoji(keywords: string[]): string {
    const culturalMap: Record<string, string> = {
      '龙': '🐉',
      '凤': '🦅',
      '茶餐厅': '🍽️',
      '维港': '🌊',
      '太平山': '⛰️',
      '叮叮车': '🚋',
      '港币': '💰',
      '月饼': '🥮',
      '狮子舞': '🦁',
      '观音': '🙏',
      '黄大仙': '✨'
    };

    for (const keyword of keywords) {
      if (culturalMap[keyword]) {
        return culturalMap[keyword];
      }
    }
    return '🌙';
  }

  private generateShareImage(dreamResult: DreamAnalysis): string {
    // 这里可以生成动态分享图片，暂时返回默认图片
    return `${this.baseUrl}/share-dream-card.png`;
  }

  private generateGameShareImage(gameType: string, score: number): string {
    return `${this.baseUrl}/share-${gameType}-card.png`;
  }

  private isWeChatBrowser(): boolean {
    return /MicroMessenger/i.test(navigator.userAgent);
  }

  private showWeChatShareModal(content: ShareContent): void {
    // 显示微信分享引导模态框
    alert('请点击右上角菜单，选择"分享给朋友"或"分享到朋友圈"');
    this.recordShare('wechat');
  }

  private showWeChatQRCode(content: ShareContent): void {
    // 显示二维码供微信扫描
    alert('请使用微信扫描二维码分享');
  }

  private recordShare(platform: string): void {
    this.shareStats.totalShares++;
    this.shareStats.platformShares[platform] = (this.shareStats.platformShares[platform] || 0) + 1;

    // 检查成就
    this.checkShareAchievements();

    // 保存统计
    this.saveShareStats();
  }

  private checkShareAchievements(): void {
    const { totalShares, achievements } = this.shareStats;

    if (totalShares >= 1 && !achievements.includes('first_share')) {
      achievements.push('first_share');
    }

    if (totalShares >= 10 && !achievements.includes('social_butterfly')) {
      achievements.push('social_butterfly');
    }

    if (totalShares >= 50 && !achievements.includes('share_master')) {
      achievements.push('share_master');
    }
  }

  private loadShareStats(): void {
    try {
      const saved = localStorage.getItem('hk_dream_share_stats');
      if (saved) {
        this.shareStats = { ...this.shareStats, ...JSON.parse(saved) };
      }
    } catch (error) {
      console.error('加载分享统计失败:', error);
    }
  }

  private saveShareStats(): void {
    try {
      localStorage.setItem('hk_dream_share_stats', JSON.stringify(this.shareStats));
    } catch (error) {
      console.error('保存分享统计失败:', error);
    }
  }

  // 公共方法
  getShareStats(): ShareStats {
    return { ...this.shareStats };
  }

  getAchievementTitle(achievement: string): string {
    const titles: Record<string, string> = {
      first_share: '🎉 首次分享',
      social_butterfly: '🦋 社交达人',
      share_master: '👑 分享大师'
    };
    return titles[achievement] || achievement;
  }
}

// 导出单例
export const socialShare = new SocialShareManager();
